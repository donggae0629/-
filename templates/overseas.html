<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>í•´ì™¸ì£¼ì‹ ìë™ë§¤ë§¤</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #1a1a1a; color: #e0e0e0; font-family: 'Malgun Gothic', sans-serif; }
        /* ë¡œê·¸ ì˜ì—­ ìŠ¤íƒ€ì¼: ê²€ì€ ë°°ê²½ì— ë…¹ìƒ‰ ê¸€ì”¨ */
        .log-area { 
            height: 520px; 
            overflow-y: auto; 
            background: #000; 
            color: #00ff00; 
            padding: 15px; 
            font-family: 'Consolas', monospace; 
            font-size: 14px; 
            border: 1px solid #444; 
            border-radius: 8px;
            line-height: 1.6;
        }
        .card { background-color: #2d2d2d; border: none; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.3); }
        .list-group-item { background-color: transparent; border-color: #444; color: #e0e0e0; padding: 12px 15px; }
        .nav-link.active { font-weight: bold; border-bottom: 2px solid #ffc107; }
        .text-warning { color: #ffc107 !important; }
    </style>
</head>
<body>
    <!-- ìƒë‹¨ ë„¤ë¹„ê²Œì´ì…˜ ë°” -->
    <nav class="navbar navbar-expand navbar-dark bg-dark mb-4 shadow">
        <div class="container">
            <div class="navbar-nav">
                <a class="nav-link" href="/">ğŸ‡°ğŸ‡· êµ­ë‚´ì£¼ì‹</a>
                <a class="nav-link active text-warning fw-bold" href="/overseas">ğŸ‡ºğŸ‡¸ í•´ì™¸ì£¼ì‹</a>
            </div>
        </div>
    </nav>

    <div class="container">
        <h2 class="mb-4 text-center text-warning fw-bold">ğŸ‡ºğŸ‡¸ í•´ì™¸ì£¼ì‹ ìë™ë§¤ë§¤ ì‹œìŠ¤í…œ</h2>
        
        <div class="row g-4">
            <!-- [ì™¼ìª½] ì œì–´ ë° ê³„ì¢Œ ì •ë³´ (4ê°œ ì»¬ëŸ¼) -->
            <div class="col-md-4">
                <!-- ë´‡ ì œì–´ ì¹´ë“œ -->
                <div class="card mb-4">
                    <div class="card-body">
                        <h5 class="card-title text-warning fw-bold mb-3">ğŸ¤– í•´ì™¸ ë´‡ ì œì–´</h5>
                        <div class="text-center mb-3">
                            <span id="status-text" class="badge bg-secondary fs-6 p-2">ì„œë²„ ì—°ê²° ì¤‘...</span>
                        </div>
                        <div class="d-grid gap-2">
                            <button onclick="startOverseasBot()" class="btn btn-warning fw-bold">â–¶ í•´ì™¸ë§¤ë§¤ ì‹œì‘</button>
                            <button onclick="stopOverseasBot()" class="btn btn-outline-danger">â¹ ë§¤ë§¤ ì •ì§€</button>
                        </div>
                    </div>
                </div>
                
                <!-- ê³„ì¢Œ ìƒíƒœ ì¹´ë“œ -->
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title text-info fw-bold mb-3">ğŸ“Š í•´ì™¸ê³„ì¢Œ ìƒíƒœ (USD)</h5>
                        <ul class="list-group list-group-flush">
                            <li class="list-group-item d-flex justify-content-between">
                                ì˜ˆìˆ˜ê¸ˆ <span id="deposit-val" class="fw-bold">$0.00</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between">
                                ì£¼ì‹ í‰ê°€ì•¡ <span id="evlu-val" class="text-info fw-bold">$0.00</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between border-top border-secondary mt-2 pt-3">
                                <span class="fw-bold">ì´ ìì‚°</span> 
                                <span id="total-val" class="text-warning fw-bold fs-5">$0.00</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between">
                                í˜„ì¬ ëª©í‘œ <span id="target-val" class="text-danger fw-bold">-</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between text-muted small">
                                ë§ˆì§€ë§‰ ê°±ì‹  <span id="update-val">-</span>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <!-- [ì˜¤ë¥¸ìª½] ì‹¤ì‹œê°„ ë¡œê·¸ì°½ (8ê°œ ì»¬ëŸ¼) -->
            <div class="col-md-8">
                <div class="card h-100">
                    <div class="card-header bg-dark text-warning fw-bold border-bottom border-secondary py-3">
                        ğŸ“œ ì‹¤ì‹œê°„ í•´ì™¸ ê±°ë˜ ë¡œê·¸
                    </div>
                    <div class="card-body p-3">
                        <div id="logs" class="log-area">í•´ì™¸ ì„œë²„ ë¡œê·¸ ëŒ€ê¸° ì¤‘...</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ìƒíƒœ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateOverseasStatus() {
            fetch('/overseas_status').then(r => r.json()).then(data => {
                // ë‹¬ëŸ¬ í¬ë§·íŒ…
                const fmt = (v) => new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' }).format(v);
                
                document.getElementById('deposit-val').innerText = fmt(data.deposit.replace(/,/g, ''));
                document.getElementById('evlu-val').innerText = fmt(data.evlu_amt.replace(/,/g, ''));
                document.getElementById('total-val').innerText = fmt(data.total_asset.replace(/,/g, ''));
                document.getElementById('target-val').innerText = data.target;
                document.getElementById('update-val').innerText = data.last_update;
                
                // ìƒíƒœ ë°°ì§€ ì—…ë°ì´íŠ¸
                const badge = document.getElementById('status-text');
                badge.innerText = data.is_running ? "í•´ì™¸ ë´‡ ê°€ë™ ì¤‘" : "ì •ì§€ë¨";
                badge.className = data.is_running ? "badge bg-success fs-6 p-2" : "badge bg-secondary fs-6 p-2";
                
                // ë¡œê·¸ ì¶œë ¥ (í•œ ì¤„ì”© divë¡œ ê°ì‹¸ì„œ)
                const logDiv = document.getElementById('logs');
                if (data.log && data.log.length > 0) {
                    logDiv.innerHTML = data.log.map(line => `<div>${line}</div>`).join('');
                }
            }).catch(err => console.error("í•´ì™¸ ìƒíƒœ ì—…ë°ì´íŠ¸ ì—ëŸ¬:", err));
        }
        
        // ë´‡ ì‹œì‘/ì •ì§€ ëª…ë ¹
        function startOverseasBot() { fetch('/overseas_start', {method:'POST'}); }
        function stopOverseasBot() { fetch('/overseas_stop', {method:'POST'}); }
        
        // 2ì´ˆë§ˆë‹¤ ê°±ì‹ 
        setInterval(updateOverseasStatus, 2000);
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì¦‰ì‹œ í•œ ë²ˆ ì‹¤í–‰
        updateOverseasStatus();
    </script>
</body>
</html>