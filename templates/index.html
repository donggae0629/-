<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>êµ­ë‚´ì£¼ì‹ ìë™ë§¤ë§¤</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f8f9fa; }
        .log-area { height: 400px; overflow-y: auto; background: #222; color: #0f0; padding: 15px; font-family: monospace; border-radius: 8px; line-height: 1.6; }
        .card { border: none; box-shadow: 0 4px 6px rgba(0,0,0,0.1); border-radius: 12px; }
        .nav-link.active { font-weight: bold; border-bottom: 2px solid white; }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand navbar-dark bg-dark mb-4">
        <div class="container">
            <div class="navbar-nav">
                <a class="nav-link active" href="/">ğŸ‡°ğŸ‡· êµ­ë‚´ì£¼ì‹</a>
                <a class="nav-link text-warning" href="/overseas">ğŸ‡ºğŸ‡¸ í•´ì™¸ì£¼ì‹</a>
            </div>
        </div>
    </nav>

    <div class="container">
        <div class="row g-4">
            <div class="col-md-4">
                <div class="card mb-3">
                    <div class="card-body">
                        <h5 class="fw-bold mb-3">ğŸ¤– ë´‡ ì œì–´</h5>
                        <div class="text-center mb-3">
                            <span id="status-text" class="badge bg-secondary fs-6">ì •ì§€ë¨</span>
                        </div>
                        <div class="mb-3">
                            <label class="form-label small fw-bold">ì „ëµ ì„ íƒ</label>
                            <select id="strategy-select" class="form-select">
                                <option value="dual_momentum">6ê°œì›” í´ë˜ì‹ ë“€ì–¼ ëª¨ë©˜í…€</option>
                                <option value="moving_average">20ì¼ ì´í‰ì„  ì¶”ì„¸ì¶”ì¢…</option>
                            </select>
                        </div>
                        <div class="d-grid gap-2">
                            <button onclick="startBot()" class="btn btn-primary">â–¶ ë§¤ë§¤ ì‹œì‘</button>
                            <button onclick="stopBot()" class="btn btn-danger">â¹ ë§¤ë§¤ ì •ì§€</button>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-body">
                        <h5 class="fw-bold mb-3">ğŸ“Š ê³„ì¢Œ ìƒíƒœ</h5>
                        <ul class="list-group list-group-flush">
                            <li class="list-group-item d-flex justify-content-between">ì˜ˆìˆ˜ê¸ˆ <span id="balance-val">0ì›</span></li>
                            <li class="list-group-item d-flex justify-content-between">í‰ê°€ì•¡ <span id="evlu-val" class="text-primary">0ì›</span></li>
                            <li class="list-group-item d-flex justify-content-between fw-bold">ì´ìì‚° <span id="total-val" class="text-success">0ì›</span></li>
                            <li class="list-group-item d-flex justify-content-between">ëª©í‘œ <span id="target-val" class="text-danger">-</span></li>
                            <li class="list-group-item d-flex justify-content-between text-muted small">ê°±ì‹  <span id="update-val">-</span></li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="col-md-8">
                <div class="card">
                    <div class="card-header bg-white fw-bold">ì‹¤ì‹œê°„ ë¡œê·¸</div>
                    <div class="card-body p-0">
                        <div id="logs" class="log-area">ë¡œê·¸ ëŒ€ê¸° ì¤‘...</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        function updateStatus() {
            fetch('/status').then(r => r.json()).then(data => {
                const fmt = (v) => new Intl.NumberFormat('ko-KR', { style: 'currency', currency: 'KRW' }).format(v);
                document.getElementById('balance-val').innerText = fmt(data.balance);
                document.getElementById('evlu-val').innerText = fmt(data.evlu_amt);
                document.getElementById('total-val').innerText = fmt(data.total_asset);
                document.getElementById('target-val').innerText = data.target;
                document.getElementById('update-val').innerText = data.last_update;
                
                const badge = document.getElementById('status-text');
                badge.innerText = data.is_running ? "ì‹¤í–‰ ì¤‘" : "ì •ì§€ë¨";
                badge.className = data.is_running ? "badge bg-success fs-6" : "badge bg-secondary fs-6";
                
                const logDiv = document.getElementById('logs');
                if (data.log.length > 0) {
                    logDiv.innerHTML = data.log.map(line => `<div>${line}</div>`).join('');
                }
            });
        }

        function startBot() {
            const strategy = document.getElementById('strategy-select').value;
            fetch('/start', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({strategy: strategy})
            });
        }

        function stopBot() { fetch('/stop', {method:'POST'}); }

        setInterval(updateStatus, 1500);
    </script>
</body>
</html>